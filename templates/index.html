<html lang="en">
<head>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.1.1/css/ol.css"
          type="text/css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.css' rel='stylesheet'/>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.6.0/mapbox-gl.css' rel='stylesheet'/>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.css' rel='stylesheet'/>
    <style>
        .map {
            height: 100%;
            width: 100%;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.1.1/build/ol.js"></script>
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.6.0/mapbox-gl.js'></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.js'></script>
    <title>OpenLayers example</title>
</head>
<body>
<div class="text-center text-info text-uppercase">
    <h1>Caza del tesoro</h1>
</div>
<div id="map" class="map"></div>
<script type="text/javascript">
        const markerSource = new ol.source.Vector();
    var puntosPuestos = new Map();
    var map = new ol.Map({
        target: 'map',
        layers: [
            new ol.layer.Tile({
                source: new ol.source.OSM()
            }),
            new ol.layer.Vector({
                source: markerSource
            })
        ],
        view: new ol.View({
            center: ol.proj.fromLonLat([-4.4785522, 36.7151063]),
            zoom: 4
        })
    });

    map.on('click', function (evt) {
        var pos = ol.proj.transform(evt.coordinate, 'EPSG:3857', 'EPSG:4326');
        addMarker(pos[0], pos[1]);
        var x = map.getFeaturesAtPixel(evt.pixel);
        for (var y of x) {
            markerSource.removeFeature(y);
            console.log("eliminado" + y.ol_iud)
        }
    });

    function addMarker(lon, lat) {
        console.log('lon:', lon);
        console.log('lat:', lat);
        /* for (var icono of puntosPuestos.values()) {
             markerSource.removeFeature(icono);
         }*/
        var iconFeature = new ol.Feature({
            geometry: new ol.geom.Point(ol.proj.transform([lon, lat], 'EPSG:4326',
                'EPSG:3857')),
            population: 4000,
            rainfall: 500
        });

        var myStyle = new ol.style.Style({
            image: new ol.style.Circle({
                radius: 7,
                fill: new ol.style.Fill({color: 'yellow'}),
                stroke: new ol.style.Stroke({
                    color: [255, 204, 0], width: 2
                })
            })
        });
        iconFeature.setStyle(myStyle);
        markerSource.addFeature(iconFeature);
        puntosPuestos.set(lon + lat, iconFeature);
    }

</script>
<script type="module" src="/static/restrict.js"></script>
</body>
</html>