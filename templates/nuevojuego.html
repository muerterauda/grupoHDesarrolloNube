{% extends "base.html" %}
{% block head %}
    <title>Inicio</title>
{% endblock %}

{% block content %}
    <div class="container-fluid">
        <hr>
        <div class="container-header text-center"><h3>Nuevo juego</h3></div>
        <hr>
        <form action="/recogerdatos" method="POST" id="myForm" enctype="multipart/form-data">
            <div class="row flex-x1-nowrap" style="margin-bottom: 10px;">
                <div class="offset-lg-2 col-lg-7 col-9">
                    <input hidden type="text" value="0" id="nTesoros" name="nTesoros">
                    <div class="input-group mb-3">
                        <label class="sr-only" for="name">Nombre</label>
                        <div class="input-group-prepend">
                                                <span class="input-group-text"
                                                      id="nombre"><b>Nombre</b></span>
                        </div>
                        <input id="name" name="nombre" class="form-control"
                               type="text"
                               aria-describedby="nombre" required placeholder="El nombre de tu aventura va aqu&iacute;">
                    </div>
                    <div class="input-group mb-3">
                        <label class="sr-only" for="descripcion">Descripcion</label>
                        <div class="input-group-prepend">
                                                <span class="input-group-text"
                                                      id="desc"><b>Descripci&oacute;n</b></span>
                        </div>
                        <textarea style="resize: none; height: 80px;" id="descripcion" name="descripcion" required
                                  aria-describedby="desc"
                                  class="form-control"
                                  placeholder="Escribe una breve descripci&oacute;n para tu juego. ¡Con un par de frases bastar&aacute;!"></textarea>
                    </div>
                    <div id="listas">
                        <div class="row">
                            <div class="col align-center">
                                <div class="map" id="map" style="min-height: 300px; padding: 5px 5px;"></div>
                            </div>
                        </div>
                    </div>
                    <br>
                    <button type="submit" class="btn btn-success">Crear juego</button>
                </div>
                <div class="col-3">
                    <div class="card bg-light" style="margin-top: 15px;">
                        <div class="card-header text-center">
                            <h3>Explicación del mapa</h3>
                        </div>
                        <div class="card-body">
                            <div class="text-center">
                                <b>Orden de los puntos</b>
                                <br/>
                                <img class="img-thumbnail rounded" src="/img/mapa.png" alt="Orden de los puntos"
                                     width="180px" height="180px"/>
                                <div id="extremos" style="margin-top: 10px;">
                                    {% for i in range(1,5) %}
                                        <div class="input-group mb-3 ">
                                            <label class="sr-only" for="punto{{ i }}">Extremo {{ i }}</label>
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"
                                                      id="extremo{{ i }}"
                                                      style="font-size: small;"><b>Extremo {{ i }}</b></span>
                                            </div>
                                            <input readonly id="punto{{ i }}" name="punto" class="form-control"
                                                   type="text"
                                                   aria-describedby="extremo{{ i }}" required style="font-size: small;">
                                        </div>
                                    {% endfor %}
                                </div>
                                <b class="card-text text-danger" style="font-size: small;">Tras marcar los 4 puntos, la
                                    zona se ajustará al espacio de juego.<br/> Si la zona de
                                    juego no se visualiza bien o no le gusta:<br/> Haz click en <i>Resetear
                                        juego</i> para empezar de nuevo. <br/> Recuerda seguir el patr&oacute;n de
                                    dibujo de arriba.</b>
                                <br/>
                                <br/>
                                <button type="button" onclick="resetearZona()"
                                        class="btn btn-danger">Resetear zona<span
                                        class="hidden-sm hidden-md hidden-xs"> de juego</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
<<<<<<< HEAD
            </form>
     </div>
    <script type="text/javascript">

        /*
        var geo;

        function obtainPolygonURL(){

            var urlLonLat='https://nominatim.openstreetmap.org/reverse?format=json&lon=' + longitud + '&lat=' + latitud;

            $.getJSON(urlLonLat, function(data0) {

            var City = data0.address.city;
            //console.log(data0);

            var urlLocation='https://nominatim.openstreetmap.org/search?format=json&q=' + City;

                $.getJSON(urlLocation, function(data1) {

                var CityLoca = data1[0];
                var urlPoly = 'https://nominatim.openstreetmap.org/reverse?format=json&osm_id=' + CityLoca.osm_id + '&osm_type=R&polygon_geojson=1';

                    $.getJSON(urlPoly, function(data2) {

                            //console.log(data);
                            geo = data2;

                    });
                });
             });
        }



        obtainPolygonURL();

        */

        var x = 1;

        //Bound para España
        //var newBound1= ol.proj.transform([-12.586875, 35.796490] , 'EPSG:4326', 'EPSG:3857'); // console.log(newBound1); -> [-1401164.5156785853, 4272654.721278845]
        //var newBound2= ol.proj.transform([5.254922, 43.049677] , 'EPSG:4326', 'EPSG:3857'); // console.log(newBound2); -> [584975.2411983708, 5319536.252219139]


        var styles = {
          'MultiPolygon': new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: 'blue',
                  lineDash: [4],
                  width: 3
                }),
                fill: new ol.style.Fill({
                  color: 'rgba(0, 0, 255, 0.1)'
            })
          })/*,
            'Polygon': new ol.style.Style({
            stroke: new ol.style.Stroke({
                  color: 'blue',
                  lineDash: [4],
                  width: 3
                }),
                fill: new ol.style.Fill({
                  color: 'rgba(0, 0, 255, 0.1)'
                })
              })
*/
        };

        var styleFunction = function(feature) {
          return styles[feature.getGeometry().getType()];
        };

        //Coordenadas random para formar el polígono -> [longitud, latitud]

        var PolyCoor1 = ol.proj.transform([-4.5878887, 36.7841131] , 'EPSG:4326', 'EPSG:3857');
        var PolyCoor2 = ol.proj.transform([-4.5812935, 36.7685439] , 'EPSG:4326', 'EPSG:3857');
        var PolyCoor3 = ol.proj.transform([-4.2936721, 36.7778861], 'EPSG:4326', 'EPSG:3857');
        var PolyCoor4 = ol.proj.transform([-4.3812535, 36.87574] , 'EPSG:4326', 'EPSG:3857');

        var geojsonObject = {
            "type":"FeatureCollection",
            'properties': {
                'name': 'EPSG:3857'
            },
            "features":[
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "MultiPolygon",
                        "coordinates": [[[PolyCoor1, PolyCoor2, PolyCoor3, PolyCoor4]]]
                    }
                }]
        };


        //console.log(PolyCoor1);
        //console.log(PolyCoor2);
        //console.log(PolyCoor3);
        //console.log(PolyCoor4);


        var vectorSource = new ol.source.Vector({
            features: (new ol.format.GeoJSON()).readFeatures(geojsonObject, 'EPSG:3857')
        });

        var vectorLayer = new ol.layer.Vector({
            source : vectorSource,
            style: styleFunction
        });

        var cen= ol.proj.transform([-4.4785522, 36.7151063], 'EPSG:4326', 'EPSG:3857');

        var map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                }),
                vectorLayer
            ],
            view: new ol.View({
                center: cen,
                extent: [-1401164.5156785853,4272654.721278845,584975.2411983708,5479536.252219139],
                zoom: 9
            })
        });

        $('#add_field').click(function () {
            $('#listas').append('<div class="row juego">\
                        <div class="row align-items-center">\
                            <div class="col">\
                                <br>\
                                <p> ID tesoro: '+x+'</p>\
                                <input type="hidden" name="ID_'+x+'" value='+x+'>\
                            </div>\
                            <div class="col">\
                                <br>\
                                <p>Pista Texto: <input type="text" name="pista_texto_'+x+'"></p>\
                            </div>\
                            \<div class="col">\
                              <br>\
                                <p>Pista Imagen: <input type="file" name="pista_imagen_'+x+'"></p>\
                            </div>\
                        </div>\
                        </div>');
            x++;
        });

    </script>
=======
        </form>
    </div>
    <script type="text/javascript" src="/js/nuevoJuego.js"></script>
>>>>>>> develoment
{% endblock %}